<!DOCTYPE html>
<!-- saved from url=(0077)https://www.kaggle.io/svf/113793/a0b2cc1a597a12ce3fc34f5273be1113/output.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta charset="utf-8">

<meta name="generator" content="pandoc">

<meta name="author" content="Christian Thiele">


<title>Rossmann Exploratory Analysis</title>

<script src="./output_files/jquery.min.js"></script><style>#header + #content > #left > #rlblock_left
{display:none !important;}</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="./output_files/bootstrap.min.css" rel="stylesheet">
<script src="./output_files/bootstrap.min.js"></script>
<script src="./output_files/html5shiv.min.js"></script>
<script src="./output_files/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet" href="./output_files/default.css" type="text/css">
<script src="./output_files/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<script type="text/javascript" src="./output_files/MathJax.js"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Hover_Arrow {position: absolute; width: 15px; height: 11px; cursor: pointer}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; color: #666666}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_Menu_Close {position: absolute; width: 31px; height: 31px; top: -15px; left: -15px}
</style><style type="text/css">.MathJax_Preview .MJXc-math {color: inherit!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXc-script {font-size: .8em}
.MJXc-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXc-bold {font-weight: bold}
.MJXc-italic {font-style: italic}
.MJXc-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-largeop {font-size: 150%}
.MJXc-largeop.MJXc-int {vertical-align: -.2em}
.MJXc-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXc-display {display: block; text-align: center; margin: 1em 0}
.MJXc-math span {display: inline-block}
.MJXc-box {display: block!important; text-align: center}
.MJXc-box:after {content: " "}
.MJXc-rule {display: block!important; margin-top: .1em}
.MJXc-char {display: block!important}
.MJXc-mo {margin: 0 .15em}
.MJXc-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXc-denom {display: inline-table!important; width: 100%}
.MJXc-denom > * {display: table-row!important}
.MJXc-surd {vertical-align: top}
.MJXc-surd > * {display: block!important}
.MJXc-script-box > *  {display: table!important; height: 50%}
.MJXc-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXc-script-box > *:last-child > * {vertical-align: bottom}
.MJXc-script-box > * > * > * {display: block!important}
.MJXc-mphantom {visibility: hidden}
.MJXc-munderover {display: inline-table!important}
.MJXc-over {display: inline-block!important; text-align: center}
.MJXc-over > * {display: block!important}
.MJXc-munderover > * {display: table-row!important}
.MJXc-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXc-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXc-mtr {display: table-row!important}
.MJXc-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXc-mtr > .MJXc-mtd:first-child {padding-left: 0}
.MJXc-mtr:first-child > .MJXc-mtd {padding-top: 0}
.MJXc-mlabeledtr {display: table-row!important}
.MJXc-mlabeledtr > .MJXc-mtd:first-child {padding-left: 0}
.MJXc-mlabeledtr:first-child > .MJXc-mtd {padding-top: 0}
.MJXc-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXc-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXc-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXc-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXc-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXc-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXc-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXc-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXc-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXc-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXc-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_CHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>

<body><div id="MathJax_Message" style="display: none;"></div>

<style type="text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div id="header">
<h1 class="title">Rossmann Exploratory Analysis</h1>
<h4 class="author"><em>Christian Thiele</em></h4>
<h4 class="date"><em><ol start="8" style="list-style-type: decimal">
<li>Oktober 2015</li>
</ol></em></h4>
</div>


<p>This is an exploratory analysis of the Rossmann Store Sales data which can be found <a href="https://www.kaggle.com/c/rossmann-store-sales">here</a>. The data isn’t huge but the speedup using data.table is noticeable. It is nice to have unmasked data which allows for some interpretations.</p>
<p>Read in the data:</p>
<pre class="r"><code class="r"><span class="keyword">library</span><span class="paren">(</span><span class="identifier">data.table</span><span class="paren">)</span>
<span class="keyword">library</span><span class="paren">(</span><span class="identifier">zoo</span><span class="paren">)</span></code></pre>
<pre><code>## 
## Attaching package: 'zoo'
## 
## The following objects are masked from 'package:base':
## 
##     as.Date, as.Date.numeric</code></pre>
<pre class="r"><code class="r"><span class="keyword">library</span><span class="paren">(</span><span class="identifier">forecast</span><span class="paren">)</span></code></pre>
<pre><code>## Loading required package: timeDate
## Loading required package: methods
## This is forecast 6.2</code></pre>
<pre class="r"><code class="r"><span class="keyword">library</span><span class="paren">(</span><span class="identifier">ggplot2</span><span class="paren">)</span>
<span class="identifier">test</span> <span class="operator">&lt;-</span> <span class="identifier">fread</span><span class="paren">(</span><span class="string">"../input/test.csv"</span><span class="paren">)</span>
<span class="identifier">train</span> <span class="operator">&lt;-</span> <span class="identifier">fread</span><span class="paren">(</span><span class="string">"../input/train.csv"</span><span class="paren">)</span>
<span class="identifier">store</span> <span class="operator">&lt;-</span> <span class="identifier">fread</span><span class="paren">(</span><span class="string">"../input/store.csv"</span><span class="paren">)</span></code></pre>
<p>Let’s have a first look at the data:</p>
<pre class="r"><code class="r"><span class="identifier">str</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">)</span></code></pre>
<pre><code>## Classes 'data.table' and 'data.frame':   1017209 obs. of  9 variables:
##  $ Store        : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ DayOfWeek    : int  5 5 5 5 5 5 5 5 5 5 ...
##  $ Date         : chr  "2015-07-31" "2015-07-31" "2015-07-31" "2015-07-31" ...
##  $ Sales        : int  5263 6064 8314 13995 4822 5651 15344 8492 8565 7185 ...
##  $ Customers    : int  555 625 821 1498 559 589 1414 833 687 681 ...
##  $ Open         : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ Promo        : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ StateHoliday : chr  "0" "0" "0" "0" ...
##  $ SchoolHoliday: chr  "1" "1" "1" "1" ...
##  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</code></pre>
<pre class="r"><code class="r"><span class="identifier">str</span><span class="paren">(</span><span class="identifier">test</span><span class="paren">)</span></code></pre>
<pre><code>## Classes 'data.table' and 'data.frame':   41088 obs. of  8 variables:
##  $ Id           : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Store        : int  1 3 7 8 9 10 11 12 13 14 ...
##  $ DayOfWeek    : int  4 4 4 4 4 4 4 4 4 4 ...
##  $ Date         : chr  "2015-09-17" "2015-09-17" "2015-09-17" "2015-09-17" ...
##  $ Open         : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ Promo        : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ StateHoliday : chr  "0" "0" "0" "0" ...
##  $ SchoolHoliday: chr  "0" "0" "0" "0" ...
##  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</code></pre>
<pre class="r"><code class="r"><span class="identifier">str</span><span class="paren">(</span><span class="identifier">store</span><span class="paren">)</span></code></pre>
<pre><code>## Classes 'data.table' and 'data.frame':   1115 obs. of  10 variables:
##  $ Store                    : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ StoreType                : chr  "c" "a" "a" "c" ...
##  $ Assortment               : chr  "a" "a" "a" "c" ...
##  $ CompetitionDistance      : int  1270 570 14130 620 29910 310 24000 7520 2030 3160 ...
##  $ CompetitionOpenSinceMonth: int  9 11 12 9 4 12 4 10 8 9 ...
##  $ CompetitionOpenSinceYear : int  2008 2007 2006 2009 2015 2013 2013 2014 2000 2009 ...
##  $ Promo2                   : int  0 1 1 0 0 0 0 0 0 0 ...
##  $ Promo2SinceWeek          : int  NA 13 14 NA NA NA NA NA NA NA ...
##  $ Promo2SinceYear          : int  NA 2010 2011 NA NA NA NA NA NA NA ...
##  $ PromoInterval            : chr  "" "Jan,Apr,Jul,Oct" "Jan,Apr,Jul,Oct" "" ...
##  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</code></pre>
<pre class="r"><code class="r"><span class="comment"># head(train); tail(train)</span>
<span class="comment"># head(test); tail(test)</span>
<span class="identifier">train</span><span class="paren">[</span>, <span class="identifier">Date</span> <span class="operator">:</span><span class="operator">=</span> <span class="identifier">as.Date</span><span class="paren">(</span><span class="identifier">Date</span><span class="paren">)</span><span class="paren">]</span>
<span class="identifier">test</span><span class="paren">[</span>, <span class="identifier">Date</span> <span class="operator">:</span><span class="operator">=</span> <span class="identifier">as.Date</span><span class="paren">(</span><span class="identifier">Date</span><span class="paren">)</span><span class="paren">]</span>
<span class="identifier">store</span></code></pre>
<pre><code>##       Store StoreType Assortment CompetitionDistance
##    1:     1         c          a                1270
##    2:     2         a          a                 570
##    3:     3         a          a               14130
##    4:     4         c          c                 620
##    5:     5         a          a               29910
##   ---                                               
## 1111:  1111         a          a                1900
## 1112:  1112         c          c                1880
## 1113:  1113         a          c                9260
## 1114:  1114         a          c                 870
## 1115:  1115         d          c                5350
##       CompetitionOpenSinceMonth CompetitionOpenSinceYear Promo2
##    1:                         9                     2008      0
##    2:                        11                     2007      1
##    3:                        12                     2006      1
##    4:                         9                     2009      0
##    5:                         4                     2015      0
##   ---                                                          
## 1111:                         6                     2014      1
## 1112:                         4                     2006      0
## 1113:                        NA                       NA      0
## 1114:                        NA                       NA      0
## 1115:                        NA                       NA      1
##       Promo2SinceWeek Promo2SinceYear    PromoInterval
##    1:              NA              NA                 
##    2:              13            2010  Jan,Apr,Jul,Oct
##    3:              14            2011  Jan,Apr,Jul,Oct
##    4:              NA              NA                 
##    5:              NA              NA                 
##   ---                                                 
## 1111:              31            2013  Jan,Apr,Jul,Oct
## 1112:              NA              NA                 
## 1113:              NA              NA                 
## 1114:              NA              NA                 
## 1115:              22            2012 Mar,Jun,Sept,Dec</code></pre>
<pre class="r"><code class="r"><span class="identifier">train</span> <span class="operator">&lt;-</span> <span class="identifier">train</span><span class="paren">[</span><span class="identifier">order</span><span class="paren">(</span><span class="identifier">Date</span><span class="paren">)</span><span class="paren">]</span>
<span class="identifier">test</span> <span class="operator">&lt;-</span> <span class="identifier">test</span><span class="paren">[</span><span class="identifier">order</span><span class="paren">(</span><span class="identifier">Date</span><span class="paren">)</span><span class="paren">]</span>
<span class="identifier">summary</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">)</span></code></pre>
<pre><code>##      Store          DayOfWeek          Date                Sales      
##  Min.   :   1.0   Min.   :1.000   Min.   :2013-01-01   Min.   :    0  
##  1st Qu.: 280.0   1st Qu.:2.000   1st Qu.:2013-08-17   1st Qu.: 3727  
##  Median : 558.0   Median :4.000   Median :2014-04-02   Median : 5744  
##  Mean   : 558.4   Mean   :3.998   Mean   :2014-04-11   Mean   : 5774  
##  3rd Qu.: 838.0   3rd Qu.:6.000   3rd Qu.:2014-12-12   3rd Qu.: 7856  
##  Max.   :1115.0   Max.   :7.000   Max.   :2015-07-31   Max.   :41551  
##    Customers           Open            Promo        StateHoliday      
##  Min.   :   0.0   Min.   :0.0000   Min.   :0.0000   Length:1017209    
##  1st Qu.: 405.0   1st Qu.:1.0000   1st Qu.:0.0000   Class :character  
##  Median : 609.0   Median :1.0000   Median :0.0000   Mode  :character  
##  Mean   : 633.1   Mean   :0.8301   Mean   :0.3815                     
##  3rd Qu.: 837.0   3rd Qu.:1.0000   3rd Qu.:1.0000                     
##  Max.   :7388.0   Max.   :1.0000   Max.   :1.0000                     
##  SchoolHoliday     
##  Length:1017209    
##  Class :character  
##  Mode  :character  
##                    
##                    
## </code></pre>
<pre class="r"><code class="r"><span class="identifier">summary</span><span class="paren">(</span><span class="identifier">test</span><span class="paren">)</span></code></pre>
<pre><code>##        Id            Store          DayOfWeek          Date           
##  Min.   :    1   Min.   :   1.0   Min.   :1.000   Min.   :2015-08-01  
##  1st Qu.:10273   1st Qu.: 279.8   1st Qu.:2.000   1st Qu.:2015-08-12  
##  Median :20544   Median : 553.5   Median :4.000   Median :2015-08-24  
##  Mean   :20544   Mean   : 555.9   Mean   :3.979   Mean   :2015-08-24  
##  3rd Qu.:30816   3rd Qu.: 832.2   3rd Qu.:6.000   3rd Qu.:2015-09-05  
##  Max.   :41088   Max.   :1115.0   Max.   :7.000   Max.   :2015-09-17  
##                                                                       
##       Open            Promo        StateHoliday       SchoolHoliday     
##  Min.   :0.0000   Min.   :0.0000   Length:41088       Length:41088      
##  1st Qu.:1.0000   1st Qu.:0.0000   Class :character   Class :character  
##  Median :1.0000   Median :0.0000   Mode  :character   Mode  :character  
##  Mean   :0.8543   Mean   :0.3958                                        
##  3rd Qu.:1.0000   3rd Qu.:1.0000                                        
##  Max.   :1.0000   Max.   :1.0000                                        
##  NA's   :11</code></pre>
<pre class="r"><code class="r"><span class="identifier">test</span><span class="paren">[</span><span class="identifier">is.na</span><span class="paren">(</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">Open</span><span class="paren">)</span>, <span class="paren">]</span> <span class="comment"># Only store 622</span></code></pre>
<pre><code>##        Id Store DayOfWeek       Date Open Promo StateHoliday SchoolHoliday
##  1: 10752   622         6 2015-09-05   NA     0            0             0
##  2:  9040   622         1 2015-09-07   NA     0            0             0
##  3:  8184   622         2 2015-09-08   NA     0            0             0
##  4:  7328   622         3 2015-09-09   NA     0            0             0
##  5:  6472   622         4 2015-09-10   NA     0            0             0
##  6:  5616   622         5 2015-09-11   NA     0            0             0
##  7:  4760   622         6 2015-09-12   NA     0            0             0
##  8:  3048   622         1 2015-09-14   NA     1            0             0
##  9:  2192   622         2 2015-09-15   NA     1            0             0
## 10:  1336   622         3 2015-09-16   NA     1            0             0
## 11:   480   622         4 2015-09-17   NA     1            0             0</code></pre>
<pre class="r"><code class="r"><span class="identifier">test</span><span class="operator">$</span><span class="identifier">Open</span><span class="paren">[</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">Store</span> <span class="operator">==</span> <span class="number">622</span><span class="paren">]</span></code></pre>
<pre><code>##  [1]  1  0  1  1  1  1  1  1  0  1  1  1  1  1  1  0  1  1  1  1  1  1  0
## [24]  1  1  1  1  1  1  0  1  1  1  1  1 NA  0 NA NA NA NA NA NA  0 NA NA
## [47] NA NA</code></pre>
<p>The test set has just 41088 rows while the train set has 1017209 rows. The public leaderboard is based on 39% of the data (16024 rows) and the private leaderboard is based on 61% of the data (25064 rows). Store 622 has 11 missing values in the <code>Open</code> columns, but not all of the data in that column of that store is missing. As was pointed out <a href="https://www.kaggle.com/c/rossmann-store-sales/forums/t/16835/open-is-blank-in-test-file-for-store-622">here</a> it should probably be imputed as 1.</p>
<p>Additionally, the whole <code>Customers</code> column is missing from the test data (since that data is only known ex post).</p>
<pre class="r"><code class="r"><span class="identifier">test</span><span class="paren">[</span><span class="identifier">is.na</span><span class="paren">(</span><span class="identifier">test</span><span class="paren">)</span><span class="paren">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></code></pre>
<p>During the test period there are no Easter or Christmas holidays but interestingly during a rather large portion of the time (44%) there are school holidays while that is the case for only 18% of the train data:</p>
<pre class="r"><code class="r"><span class="comment"># Unique values per column</span>
<span class="identifier">train</span><span class="paren">[</span>, <span class="identifier">lapply</span><span class="paren">(</span><span class="identifier">.SD</span>, <span class="keyword">function</span><span class="paren">(</span><span class="identifier">x</span><span class="paren">)</span> <span class="identifier">length</span><span class="paren">(</span><span class="identifier">unique</span><span class="paren">(</span><span class="identifier">x</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span><span class="paren">]</span></code></pre>
<pre><code>##    Store DayOfWeek Date Sales Customers Open Promo StateHoliday
## 1:  1115         7  942 21734      4086    2     2            4
##    SchoolHoliday
## 1:             2</code></pre>
<pre class="r"><code class="r"><span class="identifier">test</span><span class="paren">[</span>, <span class="identifier">lapply</span><span class="paren">(</span><span class="identifier">.SD</span>, <span class="keyword">function</span><span class="paren">(</span><span class="identifier">x</span><span class="paren">)</span> <span class="identifier">length</span><span class="paren">(</span><span class="identifier">unique</span><span class="paren">(</span><span class="identifier">x</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span><span class="paren">]</span></code></pre>
<pre><code>##       Id Store DayOfWeek Date Open Promo StateHoliday SchoolHoliday
## 1: 41088   856         7   48    2     2            2             2</code></pre>
<pre class="r"><code class="r"><span class="comment"># All test stores are also in the train data</span>
<span class="identifier">sum</span><span class="paren">(</span><span class="identifier">unique</span><span class="paren">(</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">Store</span><span class="paren">)</span> <span class="operator">%in%</span> <span class="identifier">unique</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Store</span><span class="paren">)</span><span class="paren">)</span> </code></pre>
<pre><code>## [1] 856</code></pre>
<pre class="r"><code class="r"><span class="comment"># 259 train stores are not in the test data</span>
<span class="identifier">sum</span><span class="paren">(</span><span class="operator">!</span><span class="paren">(</span><span class="identifier">unique</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Store</span><span class="paren">)</span> <span class="operator">%in%</span> <span class="identifier">unique</span><span class="paren">(</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">Store</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span> </code></pre>
<pre><code>## [1] 259</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Open</span><span class="paren">)</span> <span class="operator">/</span> <span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">)</span> <span class="comment"># Percent Open Train</span></code></pre>
<pre><code>## 
##         0         1 
## 0.1698933 0.8301067</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">Open</span><span class="paren">)</span> <span class="operator">/</span> <span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">test</span><span class="paren">)</span> <span class="comment"># Percent Open Test </span></code></pre>
<pre><code>## 
##         0         1 
## 0.1456386 0.8543614</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Promo</span><span class="paren">)</span> <span class="operator">/</span> <span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">)</span> <span class="comment"># Percent of the time promo in train</span></code></pre>
<pre><code>## 
##         0         1 
## 0.6184855 0.3815145</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">Promo</span><span class="paren">)</span> <span class="operator">/</span> <span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">test</span><span class="paren">)</span> <span class="comment"># Percent of the time promo in test</span></code></pre>
<pre><code>## 
##         0         1 
## 0.6041667 0.3958333</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">StateHoliday</span><span class="paren">)</span> <span class="operator">/</span> <span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">)</span> <span class="comment"># Percent of the time holiday in train</span></code></pre>
<pre><code>## 
##           0           a           b           c 
## 0.969475300 0.019917244 0.006576820 0.004030637</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">StateHoliday</span><span class="paren">)</span> <span class="operator">/</span> <span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">test</span><span class="paren">)</span> <span class="comment"># no b and c = no easter holiday and no christmas</span></code></pre>
<pre><code>## 
##           0           a 
## 0.995619159 0.004380841</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">SchoolHoliday</span><span class="paren">)</span> <span class="operator">/</span> <span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">)</span> <span class="comment"># Percent of the time school holiday in train</span></code></pre>
<pre><code>## 
##         0         1 
## 0.8213533 0.1786467</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">SchoolHoliday</span><span class="paren">)</span> <span class="operator">/</span> <span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">test</span><span class="paren">)</span> <span class="comment"># Percent of the time school holiday in test</span></code></pre>
<pre><code>## 
##         0         1 
## 0.5565129 0.4434871</code></pre>
<p>There are no obvious breaks in the data. The test period ranges from 2015-08-01 to 2015-09-17, so the task is to predict 48 days. The train period ranges from 2013-01-01 to 2015-07-31.</p>
<pre class="r"><code class="r"><span class="identifier">plot</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Date</span>, <span class="identifier">type</span> <span class="operator">=</span> <span class="string">"l"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-5-1.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">plot</span><span class="paren">(</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">Date</span>, <span class="identifier">type</span> <span class="operator">=</span> <span class="string">"l"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-5-2.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="comment"># As expected all 856 stores to be predicted daily</span>
<span class="identifier">all</span><span class="paren">(</span><span class="identifier">table</span><span class="paren">(</span><span class="identifier">test</span><span class="operator">$</span><span class="identifier">Date</span><span class="paren">)</span> <span class="operator">==</span> <span class="number">856</span><span class="paren">)</span> </code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Let’s look at the columns that are unique to the train set:</p>
<pre class="r"><code class="r"><span class="identifier">hist</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Sales</span>, <span class="number">100</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-6-1.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">hist</span><span class="paren">(</span><span class="identifier">aggregate</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span><span class="operator">$</span><span class="identifier">Sales</span>, 
               <span class="identifier">by</span> <span class="operator">=</span> <span class="identifier">list</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span><span class="operator">$</span><span class="identifier">Store</span><span class="paren">)</span>, <span class="identifier">mean</span><span class="paren">)</span><span class="operator">$</span><span class="identifier">x</span>, <span class="number">100</span>, 
     <span class="identifier">main</span> <span class="operator">=</span> <span class="string">"Mean sales per store when store was not closed"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-6-2.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">hist</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Customers</span>, <span class="number">100</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-6-3.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">hist</span><span class="paren">(</span><span class="identifier">aggregate</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span><span class="operator">$</span><span class="identifier">Customers</span>, 
               <span class="identifier">by</span> <span class="operator">=</span> <span class="identifier">list</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span><span class="operator">$</span><span class="identifier">Store</span><span class="paren">)</span>, <span class="identifier">mean</span><span class="paren">)</span><span class="operator">$</span><span class="identifier">x</span>, <span class="number">100</span>,
     <span class="identifier">main</span> <span class="operator">=</span> <span class="string">"Mean customers per store when store was not closed"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-6-4.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>, <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">SchoolHoliday</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span>
    <span class="identifier">geom_jitter</span><span class="paren">(</span><span class="identifier">alpha</span> <span class="operator">=</span> <span class="number">0.1</span><span class="paren">)</span> <span class="operator">+</span>
    <span class="identifier">geom_boxplot</span><span class="paren">(</span><span class="identifier">color</span> <span class="operator">=</span> <span class="string">"yellow"</span>, <span class="identifier">outlier.colour</span> <span class="operator">=</span> <span class="literal">NA</span>, <span class="identifier">fill</span> <span class="operator">=</span> <span class="literal">NA</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-6-5.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span> <span class="operator">&amp;</span> <span class="identifier">train</span><span class="operator">$</span><span class="identifier">Customers</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>,
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">log</span><span class="paren">(</span><span class="identifier">Customers</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">log</span><span class="paren">(</span><span class="identifier">Sales</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_point</span><span class="paren">(</span><span class="identifier">alpha</span> <span class="operator">=</span> <span class="number">0.2</span><span class="paren">)</span> <span class="operator">+</span> <span class="identifier">geom_smooth</span><span class="paren">(</span><span class="paren">)</span></code></pre>
<pre><code>## geom_smooth: method="auto" and size of largest group is &gt;=1000, so using gam with formula: y ~ s(x, bs = "cs"). Use 'method = x' to change the smoothing method.</code></pre>
<p><img src="./output_files/unnamed-chunk-6-6.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span> <span class="operator">&amp;</span> <span class="identifier">train</span><span class="operator">$</span><span class="identifier">Customers</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>,
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">Promo</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_jitter</span><span class="paren">(</span><span class="identifier">alpha</span> <span class="operator">=</span> <span class="number">0.1</span><span class="paren">)</span> <span class="operator">+</span>
    <span class="identifier">geom_boxplot</span><span class="paren">(</span><span class="identifier">color</span> <span class="operator">=</span> <span class="string">"yellow"</span>, <span class="identifier">outlier.colour</span> <span class="operator">=</span> <span class="literal">NA</span>, <span class="identifier">fill</span> <span class="operator">=</span> <span class="literal">NA</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-6-7.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span> <span class="operator">&amp;</span> <span class="identifier">train</span><span class="operator">$</span><span class="identifier">Customers</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>,
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">Promo</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Customers</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_jitter</span><span class="paren">(</span><span class="identifier">alpha</span> <span class="operator">=</span> <span class="number">0.1</span><span class="paren">)</span> <span class="operator">+</span>
    <span class="identifier">geom_boxplot</span><span class="paren">(</span><span class="identifier">color</span> <span class="operator">=</span> <span class="string">"yellow"</span>, <span class="identifier">outlier.colour</span> <span class="operator">=</span> <span class="literal">NA</span>, <span class="identifier">fill</span> <span class="operator">=</span> <span class="literal">NA</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-6-8.png" title="" alt="" width="672"></p>
<p>Note: I chose to not plot that data including days with 0 sales or customers because that would have biased the boxplots.</p>
<p>Sales is as expected strongly correlated with the number of customers. It looks like the Boxplots of customers overlap a little more than the boxplots of sales. This would mean that the promos are not mainly attracting more customers but make customers spend more. The mean amount spent per customer is about one Euro higher:</p>
<pre class="r"><code class="r"><span class="identifier">with</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span> <span class="operator">&amp;</span> <span class="identifier">train</span><span class="operator">$</span><span class="identifier">Promo</span> <span class="operator">==</span> <span class="number">0</span><span class="paren">]</span>, <span class="identifier">mean</span><span class="paren">(</span><span class="identifier">Sales</span> <span class="operator">/</span> <span class="identifier">Customers</span><span class="paren">)</span><span class="paren">)</span></code></pre>
<pre><code>## [1] 8.941128</code></pre>
<pre class="r"><code class="r"><span class="identifier">with</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span> <span class="operator">&amp;</span> <span class="identifier">train</span><span class="operator">$</span><span class="identifier">Promo</span> <span class="operator">==</span> <span class="number">1</span><span class="paren">]</span>, <span class="identifier">mean</span><span class="paren">(</span><span class="identifier">Sales</span> <span class="operator">/</span> <span class="identifier">Customers</span><span class="paren">)</span><span class="paren">)</span></code></pre>
<pre><code>## [1] 10.17896</code></pre>
<p>There are sometimes promos while the respective store is closed and there are promos 45% of the time:</p>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">ifelse</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span>, <span class="string">"Sales &gt; 0"</span>, <span class="string">"Sales = 0"</span><span class="paren">)</span>,
      <span class="identifier">ifelse</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Promo</span>, <span class="string">"Promo"</span>, <span class="string">"No promo"</span><span class="paren">)</span><span class="paren">)</span></code></pre>
<pre><code>##            
##             No promo  Promo
##   Sales = 0   161666  11205
##   Sales &gt; 0   467463 376875</code></pre>
<p>At least there are no sales when the stores are closed but there are some stores that, according to the data, made no sales although they were opened even if they had some customers. These observations <em>may</em> be errors in the data / outliers:</p>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">ifelse</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Open</span> <span class="operator">==</span> <span class="number">1</span>, <span class="string">"Opened"</span>, <span class="string">"Closed"</span><span class="paren">)</span>,
      <span class="identifier">ifelse</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Sales</span> <span class="operator">&gt;</span> <span class="number">0</span>, <span class="string">"Sales &gt; 0"</span>, <span class="string">"Sales = 0"</span><span class="paren">)</span><span class="paren">)</span></code></pre>
<pre><code>##         
##          Sales = 0 Sales &gt; 0
##   Closed    172817         0
##   Opened        54    844338</code></pre>
<pre class="r"><code class="r"><span class="comment"># That tends to happen on consecutive days. Some stores even had customers</span>
<span class="comment"># (who bought nothing?)</span>
<span class="identifier">train</span><span class="paren">[</span><span class="identifier">Open</span> <span class="operator">==</span> <span class="number">1</span> <span class="operator">&amp;</span> <span class="identifier">Sales</span> <span class="operator">==</span> <span class="number">0</span><span class="paren">]</span></code></pre>
<pre><code>##     Store DayOfWeek       Date Sales Customers Open Promo StateHoliday
##  1:   762         4 2013-01-17     0         0    1     0            0
##  2:   232         4 2013-01-24     0         0    1     1            0
##  3:   339         3 2013-01-30     0         0    1     0            0
##  4:   339         4 2013-01-31     0         0    1     0            0
##  5:   259         4 2013-02-07     0         0    1     1            0
##  6:   353         6 2013-03-16     0         0    1     0            0
##  7:   948         4 2013-04-25     0         5    1     1            0
##  8:   589         1 2013-04-29     0         0    1     1            0
##  9:   364         2 2013-05-07     0         0    1     0            0
## 10:   364         3 2013-05-08     0         0    1     0            0
## 11:   681         5 2013-05-10     0         0    1     0            0
## 12:   700         3 2013-06-05     0         0    1     1            0
## 13:   665         5 2013-06-28     0         0    1     0            0
## 14:   665         6 2013-06-29     0         0    1     0            0
## 15:  1039         2 2013-07-09     0         0    1     0            0
## 16:  1039         3 2013-07-10     0         0    1     0            0
## 17:   927         4 2013-08-08     0         0    1     0            0
## 18:   391         3 2013-08-28     0         0    1     1            0
## 19:   663         1 2013-09-02     0         0    1     0            0
## 20:   983         5 2014-01-17     0         0    1     0            0
## 21:   983         6 2014-01-18     0         0    1     0            0
## 22:   623         5 2014-01-24     0         0    1     1            0
## 23:   623         6 2014-01-25     0         0    1     0            0
## 24:    25         3 2014-02-12     0         0    1     0            0
## 25:    25         4 2014-02-13     0         0    1     0            0
## 26:   327         3 2014-03-12     0         0    1     0            0
## 27:   986         2 2014-03-18     0         0    1     1            0
## 28:   850         6 2014-03-29     0         0    1     0            0
## 29:   661         5 2014-04-04     0         0    1     1            0
## 30:  1100         2 2014-04-29     0         3    1     1            0
## 31:  1100         3 2014-04-30     0         0    1     1            0
## 32:  1017         3 2014-06-04     0         0    1     1            0
## 33:  1017         4 2014-06-05     0         0    1     1            0
## 34:    57         2 2014-07-01     0         0    1     1            0
## 35:   925         4 2014-07-03     0         0    1     1            0
## 36:   102         6 2014-07-12     0         0    1     0            0
## 37:   882         3 2014-07-23     0         0    1     0            0
## 38:   887         3 2014-07-23     0         0    1     0            0
## 39:   102         4 2014-07-24     0         0    1     0            0
## 40:   238         4 2014-07-24     0         0    1     0            0
## 41:   303         4 2014-07-24     0         0    1     0            0
## 42:   387         4 2014-07-24     0         0    1     0            0
## 43:    28         2 2014-09-02     0         0    1     1            0
## 44:    28         3 2014-09-03     0         0    1     1            0
## 45:    28         4 2014-09-04     0         0    1     1            0
## 46:   548         5 2014-09-05     0         0    1     1            0
## 47:   835         3 2014-09-10     0         0    1     0            0
## 48:   227         4 2014-09-11     0         0    1     0            0
## 49:   835         4 2014-09-11     0         0    1     0            0
## 50:   357         1 2014-09-22     0         0    1     0            0
## 51:   708         3 2014-10-01     0         0    1     1            0
## 52:   699         4 2015-02-05     0         0    1     1            0
## 53:   674         4 2015-03-26     0         0    1     0            0
## 54:   971         5 2015-05-15     0         0    1     0            0
##     Store DayOfWeek       Date Sales Customers Open Promo StateHoliday
##     SchoolHoliday
##  1:             0
##  2:             0
##  3:             0
##  4:             0
##  5:             0
##  6:             0
##  7:             0
##  8:             0
##  9:             0
## 10:             0
## 11:             0
## 12:             0
## 13:             0
## 14:             0
## 15:             0
## 16:             0
## 17:             1
## 18:             1
## 19:             1
## 20:             0
## 21:             0
## 22:             0
## 23:             0
## 24:             0
## 25:             0
## 26:             0
## 27:             0
## 28:             0
## 29:             0
## 30:             0
## 31:             0
## 32:             0
## 33:             0
## 34:             0
## 35:             0
## 36:             0
## 37:             1
## 38:             0
## 39:             1
## 40:             1
## 41:             1
## 42:             1
## 43:             1
## 44:             1
## 45:             0
## 46:             1
## 47:             0
## 48:             0
## 49:             0
## 50:             0
## 51:             0
## 52:             0
## 53:             0
## 54:             1
##     SchoolHoliday</code></pre>
<p>The stores have different amounts of days with zero sales. There are spikes in the sales before the stores close and after the reopen:</p>
<pre class="r"><code class="r"><span class="identifier">zerosPerStore</span> <span class="operator">&lt;-</span> <span class="identifier">sort</span><span class="paren">(</span><span class="identifier">tapply</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Sales</span>, <span class="identifier">list</span><span class="paren">(</span><span class="identifier">train</span><span class="operator">$</span><span class="identifier">Store</span><span class="paren">)</span>, <span class="keyword">function</span><span class="paren">(</span><span class="identifier">x</span><span class="paren">)</span> <span class="identifier">sum</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">==</span> <span class="number">0</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span>
<span class="identifier">hist</span><span class="paren">(</span><span class="identifier">zerosPerStore</span>,<span class="number">100</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-10-1.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="comment"># Stores with the most zeros in their sales:</span>
<span class="identifier">tail</span><span class="paren">(</span><span class="identifier">zerosPerStore</span>, <span class="number">10</span><span class="paren">)</span></code></pre>
<pre><code>## 105 339 837  25 560 674 972 349 708 103 
## 188 188 191 192 195 197 240 242 255 311</code></pre>
<pre class="r"><code class="r"><span class="comment"># Some stores were closed for some time, some of those were closed multiple times</span>
<span class="identifier">plot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Store</span> <span class="operator">==</span> <span class="number">972</span>, <span class="identifier">Sales</span><span class="paren">]</span>, <span class="identifier">ylab</span> <span class="operator">=</span> <span class="string">"Sales"</span>, <span class="identifier">xlab</span> <span class="operator">=</span> <span class="string">"Days"</span>, <span class="identifier">main</span> <span class="operator">=</span> <span class="string">"Store 972"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-10-2.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">plot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Store</span> <span class="operator">==</span> <span class="number">103</span>, <span class="identifier">Sales</span><span class="paren">]</span>, <span class="identifier">ylab</span> <span class="operator">=</span> <span class="string">"Sales"</span>, <span class="identifier">xlab</span> <span class="operator">=</span> <span class="string">"Days"</span>, <span class="identifier">main</span> <span class="operator">=</span> <span class="string">"Store 103"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-10-3.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">plot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Store</span> <span class="operator">==</span> <span class="number">708</span>, <span class="identifier">Sales</span><span class="paren">]</span>, <span class="identifier">ylab</span> <span class="operator">=</span> <span class="string">"Sales"</span>, <span class="identifier">xlab</span> <span class="operator">=</span> <span class="string">"Days"</span>, <span class="identifier">main</span> <span class="operator">=</span> <span class="string">"Store 708"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-10-4.png" title="" alt="" width="672"></p>
<p>There are also stores that have <em>no</em> zeros in their sales. These are the exception since they are opened also on sundays / holidays. The sales of those stores on sundays are particularly high:</p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Store</span> <span class="operator">==</span> <span class="number">85</span><span class="paren">]</span>, 
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">Date</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span>, 
           <span class="identifier">color</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">DayOfWeek</span> <span class="operator">==</span> <span class="number">7</span><span class="paren">)</span>, <span class="identifier">shape</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">DayOfWeek</span> <span class="operator">==</span> <span class="number">7</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_point</span><span class="paren">(</span><span class="identifier">size</span> <span class="operator">=</span> <span class="number">3</span><span class="paren">)</span> <span class="operator">+</span> <span class="identifier">ggtitle</span><span class="paren">(</span><span class="string">"Sales of store 85 (True if sunday)"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-11-1.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Store</span> <span class="operator">==</span> <span class="number">262</span><span class="paren">]</span>, 
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">Date</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span>, 
           <span class="identifier">color</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">DayOfWeek</span> <span class="operator">==</span> <span class="number">7</span><span class="paren">)</span>, <span class="identifier">shape</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">DayOfWeek</span> <span class="operator">==</span> <span class="number">7</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_point</span><span class="paren">(</span><span class="identifier">size</span> <span class="operator">=</span> <span class="number">3</span><span class="paren">)</span> <span class="operator">+</span> <span class="identifier">ggtitle</span><span class="paren">(</span><span class="string">"Sales of store 262 (True if sunday)"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-11-2.png" title="" alt="" width="672"></p>
<p>That is not true in general. The variability of sales on sundays is quite high while the median is not:</p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>,
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">DayOfWeek</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_jitter</span><span class="paren">(</span><span class="identifier">alpha</span> <span class="operator">=</span> <span class="number">0.1</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_boxplot</span><span class="paren">(</span><span class="identifier">color</span> <span class="operator">=</span> <span class="string">"yellow"</span>, <span class="identifier">outlier.colour</span> <span class="operator">=</span> <span class="literal">NA</span>, <span class="identifier">fill</span> <span class="operator">=</span> <span class="literal">NA</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-12-1.png" title="" alt="" width="672"></p>
<p><strong>The <code>store</code> file contains information about the stores that can be linked to <code>train</code> and <code>test</code> via the store ID.</strong></p>
<pre class="r"><code class="r"><span class="identifier">summary</span><span class="paren">(</span><span class="identifier">store</span><span class="paren">)</span></code></pre>
<pre><code>##      Store         StoreType          Assortment       
##  Min.   :   1.0   Length:1115        Length:1115       
##  1st Qu.: 279.5   Class :character   Class :character  
##  Median : 558.0   Mode  :character   Mode  :character  
##  Mean   : 558.0                                        
##  3rd Qu.: 836.5                                        
##  Max.   :1115.0                                        
##                                                        
##  CompetitionDistance CompetitionOpenSinceMonth CompetitionOpenSinceYear
##  Min.   :   20.0     Min.   : 1.000            Min.   :1900            
##  1st Qu.:  717.5     1st Qu.: 4.000            1st Qu.:2006            
##  Median : 2325.0     Median : 8.000            Median :2010            
##  Mean   : 5404.9     Mean   : 7.225            Mean   :2009            
##  3rd Qu.: 6882.5     3rd Qu.:10.000            3rd Qu.:2013            
##  Max.   :75860.0     Max.   :12.000            Max.   :2015            
##  NA's   :3           NA's   :354               NA's   :354             
##      Promo2       Promo2SinceWeek Promo2SinceYear PromoInterval     
##  Min.   :0.0000   Min.   : 1.0    Min.   :2009    Length:1115       
##  1st Qu.:0.0000   1st Qu.:13.0    1st Qu.:2011    Class :character  
##  Median :1.0000   Median :22.0    Median :2012    Mode  :character  
##  Mean   :0.5121   Mean   :23.6    Mean   :2012                      
##  3rd Qu.:1.0000   3rd Qu.:37.0    3rd Qu.:2013                      
##  Max.   :1.0000   Max.   :50.0    Max.   :2015                      
##                   NA's   :544     NA's   :544</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">store</span><span class="operator">$</span><span class="identifier">StoreType</span><span class="paren">)</span></code></pre>
<pre><code>## 
##   a   b   c   d 
## 602  17 148 348</code></pre>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">store</span><span class="operator">$</span><span class="identifier">Assortment</span><span class="paren">)</span></code></pre>
<pre><code>## 
##   a   b   c 
## 593   9 513</code></pre>
<pre class="r"><code class="r"><span class="comment"># There is a connection between store type and type of assortment</span>
<span class="identifier">table</span><span class="paren">(</span><span class="identifier">data.frame</span><span class="paren">(</span><span class="identifier">Assortment</span> <span class="operator">=</span> <span class="identifier">store</span><span class="operator">$</span><span class="identifier">Assortment</span>, <span class="identifier">StoreType</span> <span class="operator">=</span> <span class="identifier">store</span><span class="operator">$</span><span class="identifier">StoreType</span><span class="paren">)</span><span class="paren">)</span></code></pre>
<pre><code>##           StoreType
## Assortment   a   b   c   d
##          a 381   7  77 128
##          b   0   9   0   0
##          c 221   1  71 220</code></pre>
<pre class="r"><code class="r"><span class="identifier">hist</span><span class="paren">(</span><span class="identifier">store</span><span class="operator">$</span><span class="identifier">CompetitionDistance</span>, <span class="number">100</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-13-1.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="comment"># Convert the CompetitionOpenSince... variables to one Date variable</span>
<span class="identifier">store</span><span class="operator">$</span><span class="identifier">CompetitionOpenSince</span> <span class="operator">&lt;-</span> <span class="identifier">as.yearmon</span><span class="paren">(</span><span class="identifier">paste</span><span class="paren">(</span><span class="identifier">store</span><span class="operator">$</span><span class="identifier">CompetitionOpenSinceYear</span>, 
                                               <span class="identifier">store</span><span class="operator">$</span><span class="identifier">CompetitionOpenSinceMonth</span>, <span class="identifier">sep</span> <span class="operator">=</span> <span class="string">"-"</span><span class="paren">)</span><span class="paren">)</span>
<span class="comment"># One competitor opened 1900</span>
<span class="identifier">hist</span><span class="paren">(</span><span class="identifier">as.yearmon</span><span class="paren">(</span><span class="string">"2015-10"</span><span class="paren">)</span> <span class="operator">-</span> <span class="identifier">store</span><span class="operator">$</span><span class="identifier">CompetitionOpenSince</span>, <span class="number">100</span>, 
     <span class="identifier">main</span> <span class="operator">=</span> <span class="string">"Years since opening of nearest competition"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-13-2.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="comment"># Convert the Promo2Since... variables to one Date variable</span>
<span class="comment"># Assume that the promo starts on the first day of the week</span>
<span class="identifier">store</span><span class="operator">$</span><span class="identifier">Promo2Since</span> <span class="operator">&lt;-</span> <span class="identifier">as.POSIXct</span><span class="paren">(</span><span class="identifier">paste</span><span class="paren">(</span><span class="identifier">store</span><span class="operator">$</span><span class="identifier">Promo2SinceYear</span>, 
                                   <span class="identifier">store</span><span class="operator">$</span><span class="identifier">Promo2SinceWeek</span>, <span class="number">1</span>, <span class="identifier">sep</span> <span class="operator">=</span> <span class="string">"-"</span><span class="paren">)</span>,
                             <span class="identifier">format</span> <span class="operator">=</span> <span class="string">"%Y-%U-%u"</span><span class="paren">)</span>
<span class="identifier">hist</span><span class="paren">(</span><span class="identifier">as.numeric</span><span class="paren">(</span><span class="identifier">as.POSIXct</span><span class="paren">(</span><span class="string">"2015-10-01"</span>, <span class="identifier">format</span> <span class="operator">=</span> <span class="string">"%Y-%m-%d"</span><span class="paren">)</span> <span class="operator">-</span> <span class="identifier">store</span><span class="operator">$</span><span class="identifier">Promo2Since</span><span class="paren">)</span>, 
     <span class="number">100</span>, <span class="identifier">main</span> <span class="operator">=</span> <span class="string">"Days since start of promo2"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-13-3.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">table</span><span class="paren">(</span><span class="identifier">store</span><span class="operator">$</span><span class="identifier">PromoInterval</span><span class="paren">)</span></code></pre>
<pre><code>## 
##                   Feb,May,Aug,Nov  Jan,Apr,Jul,Oct Mar,Jun,Sept,Dec 
##              544              130              335              106</code></pre>
<p>The stores with promos tend to make lower sales. This does not necessary mean that the promos don’t help or are counterproductive. They are possibly measures that are taken mainly by stores with low sales in the first place:</p>
<pre class="r"><code class="r"><span class="comment"># Merge store and train </span>
<span class="identifier">train_store</span> <span class="operator">&lt;-</span> <span class="identifier">merge</span><span class="paren">(</span><span class="identifier">train</span>, <span class="identifier">store</span>, <span class="identifier">by</span> <span class="operator">=</span> <span class="string">"Store"</span><span class="paren">)</span>
<span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>, <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">PromoInterval</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_jitter</span><span class="paren">(</span><span class="identifier">alpha</span> <span class="operator">=</span> <span class="number">0.1</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_boxplot</span><span class="paren">(</span><span class="identifier">color</span> <span class="operator">=</span> <span class="string">"yellow"</span>, <span class="identifier">outlier.colour</span> <span class="operator">=</span> <span class="literal">NA</span>, <span class="identifier">fill</span> <span class="operator">=</span> <span class="literal">NA</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-14-1.png" title="" alt="" width="672"></p>
<p>The different store types and assortment types imply different overall levels of sales and seem to be exhibiting different trends:</p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>, 
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">as.Date</span><span class="paren">(</span><span class="identifier">Date</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span>, <span class="identifier">color</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">StoreType</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_smooth</span><span class="paren">(</span><span class="identifier">size</span> <span class="operator">=</span> <span class="number">1</span><span class="paren">)</span></code></pre>
<pre><code>## geom_smooth: method="auto" and size of largest group is &gt;=1000, so using gam with formula: y ~ s(x, bs = "cs"). Use 'method = x' to change the smoothing method.</code></pre>
<p><img src="./output_files/unnamed-chunk-15-1.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">Customers</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>, 
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">as.Date</span><span class="paren">(</span><span class="identifier">Date</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Customers</span>, <span class="identifier">color</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">StoreType</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_smooth</span><span class="paren">(</span><span class="identifier">size</span> <span class="operator">=</span> <span class="number">1</span><span class="paren">)</span></code></pre>
<pre><code>## geom_smooth: method="auto" and size of largest group is &gt;=1000, so using gam with formula: y ~ s(x, bs = "cs"). Use 'method = x' to change the smoothing method.</code></pre>
<p><img src="./output_files/unnamed-chunk-15-2.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>, 
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">as.Date</span><span class="paren">(</span><span class="identifier">Date</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span>, <span class="identifier">color</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">Assortment</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_smooth</span><span class="paren">(</span><span class="identifier">size</span> <span class="operator">=</span> <span class="number">1</span><span class="paren">)</span></code></pre>
<pre><code>## geom_smooth: method="auto" and size of largest group is &gt;=1000, so using gam with formula: y ~ s(x, bs = "cs"). Use 'method = x' to change the smoothing method.</code></pre>
<p><img src="./output_files/unnamed-chunk-15-3.png" title="" alt="" width="672"></p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>, 
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">as.Date</span><span class="paren">(</span><span class="identifier">Date</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Customers</span>, <span class="identifier">color</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="identifier">Assortment</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_smooth</span><span class="paren">(</span><span class="identifier">size</span> <span class="operator">=</span> <span class="number">1</span><span class="paren">)</span></code></pre>
<pre><code>## geom_smooth: method="auto" and size of largest group is &gt;=1000, so using gam with formula: y ~ s(x, bs = "cs"). Use 'method = x' to change the smoothing method.</code></pre>
<p><img src="./output_files/unnamed-chunk-15-4.png" title="" alt="" width="672"></p>
<p>The effect of the distance to the next competitor is a little counterintuitive. Lower distance to the next competitor implies (slightly, possibly not significantly) higher sales. This may occur (my assumption) because stores with a low distance to the next competitor are located in inner cities or crowded regions with higher sales in general. Maybe the effects of being in a good / bad region and having a competitor / not having a competitor cancel out:</p>
<pre class="r"><code class="r"><span class="identifier">salesByDist</span> <span class="operator">&lt;-</span> <span class="identifier">aggregate</span><span class="paren">(</span><span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span> <span class="operator">&amp;</span> <span class="operator">!</span><span class="identifier">is.na</span><span class="paren">(</span><span class="identifier">CompetitionDistance</span><span class="paren">)</span><span class="paren">]</span><span class="operator">$</span><span class="identifier">Sales</span>, 
               <span class="identifier">by</span> <span class="operator">=</span> <span class="identifier">list</span><span class="paren">(</span><span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span> <span class="operator">&amp;</span> <span class="operator">!</span><span class="identifier">is.na</span><span class="paren">(</span><span class="identifier">CompetitionDistance</span><span class="paren">)</span><span class="paren">]</span><span class="operator">$</span><span class="identifier">CompetitionDistance</span><span class="paren">)</span>, <span class="identifier">mean</span><span class="paren">)</span>
<span class="identifier">colnames</span><span class="paren">(</span><span class="identifier">salesByDist</span><span class="paren">)</span> <span class="operator">&lt;-</span> <span class="identifier">c</span><span class="paren">(</span><span class="string">"CompetitionDistance"</span>, <span class="string">"MeanSales"</span><span class="paren">)</span>
<span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">salesByDist</span>, <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">log</span><span class="paren">(</span><span class="identifier">CompetitionDistance</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">log</span><span class="paren">(</span><span class="identifier">MeanSales</span><span class="paren">)</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_point</span><span class="paren">(</span><span class="paren">)</span> <span class="operator">+</span> <span class="identifier">geom_smooth</span><span class="paren">(</span><span class="paren">)</span></code></pre>
<pre><code>## geom_smooth: method="auto" and size of largest group is &lt;1000, so using loess. Use 'method = x' to change the smoothing method.</code></pre>
<p><img src="./output_files/unnamed-chunk-16-1.png" title="" alt="" width="672"></p>
<p>A missing value for <code>CompetitionDistance</code> doesn’t necessarily mean that there is no competiton. Maybe that data was just not collected, yet. There is no obvious connection between sales and having <code>NA</code> as <code>CompetitionDistance</code>:</p>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>,
       <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">factor</span><span class="paren">(</span><span class="operator">!</span><span class="identifier">is.na</span><span class="paren">(</span><span class="identifier">CompetitionOpenSinceYear</span><span class="paren">)</span><span class="paren">)</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span>
    <span class="identifier">geom_jitter</span><span class="paren">(</span><span class="identifier">alpha</span> <span class="operator">=</span> <span class="number">0.1</span><span class="paren">)</span> <span class="operator">+</span>
    <span class="identifier">geom_boxplot</span><span class="paren">(</span><span class="identifier">color</span> <span class="operator">=</span> <span class="string">"yellow"</span>, <span class="identifier">outlier.colour</span> <span class="operator">=</span> <span class="literal">NA</span>, <span class="identifier">fill</span> <span class="operator">=</span> <span class="literal">NA</span><span class="paren">)</span> <span class="operator">+</span>
    <span class="identifier">ggtitle</span><span class="paren">(</span><span class="string">"Any competition?"</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-17-1.png" title="" alt="" width="672"></p>
<p>So what happens if a competitor opens? In order to assess this effect we fetch data from all stores that first have <code>NA</code> as <code>CompetitorDistance</code> and later some value. <strong>Only the month, not the date, of the opening of the competitor is known so we need a rather large window to see the effect (100 days)</strong>. 147 stores had a competitor move into their area during the available time span. The competition leaves a ‘dent’ in the sales which looks a little different depending on the chosen <code>timespan</code> so I wouldn’t like to argue about statistical significance based on this plot alone. It’s informative to look at anyway:</p>
<pre class="r"><code class="r"><span class="comment"># Sales before and after competition opens</span>
<span class="identifier">train_store</span><span class="operator">$</span><span class="identifier">DateYearmon</span> <span class="operator">&lt;-</span> <span class="identifier">as.yearmon</span><span class="paren">(</span><span class="identifier">train_store</span><span class="operator">$</span><span class="identifier">Date</span><span class="paren">)</span>
<span class="identifier">train_store</span> <span class="operator">&lt;-</span> <span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">order</span><span class="paren">(</span><span class="identifier">Date</span><span class="paren">)</span><span class="paren">]</span>
<span class="identifier">timespan</span> <span class="operator">&lt;-</span> <span class="number">100</span> <span class="comment"># Days to collect before and after Opening of competition</span>
<span class="identifier">beforeAndAfterComp</span> <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="paren">(</span><span class="identifier">s</span><span class="paren">)</span> <span class="paren">{</span>
    <span class="identifier">x</span> <span class="operator">&lt;-</span> <span class="identifier">train_store</span><span class="paren">[</span><span class="identifier">Store</span> <span class="operator">==</span> <span class="identifier">s</span><span class="paren">]</span>
    <span class="identifier">daysWithComp</span> <span class="operator">&lt;-</span> <span class="identifier">x</span><span class="operator">$</span><span class="identifier">CompetitionOpenSince</span> <span class="operator">&gt;=</span> <span class="identifier">x</span><span class="operator">$</span><span class="identifier">DateYearmon</span>
    <span class="keyword">if</span> <span class="paren">(</span><span class="identifier">any</span><span class="paren">(</span><span class="operator">!</span><span class="identifier">daysWithComp</span><span class="paren">)</span><span class="paren">)</span> <span class="paren">{</span>
        <span class="identifier">compOpening</span> <span class="operator">&lt;-</span> <span class="identifier">head</span><span class="paren">(</span><span class="identifier">which</span><span class="paren">(</span><span class="operator">!</span><span class="identifier">daysWithComp</span><span class="paren">)</span>, <span class="number">1</span><span class="paren">)</span> <span class="operator">-</span> <span class="number">1</span>
        <span class="keyword">if</span> <span class="paren">(</span><span class="identifier">compOpening</span> <span class="operator">&gt;</span> <span class="identifier">timespan</span> <span class="operator">&amp;</span> <span class="identifier">compOpening</span> <span class="operator">&lt;</span> <span class="paren">(</span><span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">x</span><span class="paren">)</span> <span class="operator">-</span> <span class="identifier">timespan</span><span class="paren">)</span><span class="paren">)</span> <span class="paren">{</span>
           <span class="identifier">x</span> <span class="operator">&lt;-</span> <span class="identifier">x</span><span class="paren">[</span><span class="paren">(</span><span class="identifier">compOpening</span> <span class="operator">-</span> <span class="identifier">timespan</span><span class="paren">)</span><span class="operator">:</span><span class="paren">(</span><span class="identifier">compOpening</span> <span class="operator">+</span> <span class="identifier">timespan</span><span class="paren">)</span>, <span class="paren">]</span> 
            <span class="identifier">x</span><span class="operator">$</span><span class="identifier">Day</span> <span class="operator">&lt;-</span> <span class="number">1</span><span class="operator">:</span><span class="identifier">nrow</span><span class="paren">(</span><span class="identifier">x</span><span class="paren">)</span>
            <span class="keyword">return</span><span class="paren">(</span><span class="identifier">x</span><span class="paren">)</span>
        <span class="paren">}</span>
    <span class="paren">}</span>
<span class="paren">}</span>
<span class="identifier">temp</span> <span class="operator">&lt;-</span> <span class="identifier">lapply</span><span class="paren">(</span><span class="identifier">unique</span><span class="paren">(</span><span class="identifier">train_store</span><span class="paren">[</span><span class="operator">!</span><span class="identifier">is.na</span><span class="paren">(</span><span class="identifier">CompetitionOpenSince</span><span class="paren">)</span><span class="paren">]</span><span class="operator">$</span><span class="identifier">Store</span><span class="paren">)</span>, <span class="identifier">beforeAndAfterComp</span><span class="paren">)</span>
<span class="identifier">temp</span> <span class="operator">&lt;-</span> <span class="identifier">do.call</span><span class="paren">(</span><span class="identifier">rbind</span>, <span class="identifier">temp</span><span class="paren">)</span>
<span class="comment"># 147 stores first had no competition but at least 100 days before the end</span>
<span class="comment"># of the data set</span>
<span class="identifier">length</span><span class="paren">(</span><span class="identifier">unique</span><span class="paren">(</span><span class="identifier">temp</span><span class="operator">$</span><span class="identifier">Store</span><span class="paren">)</span><span class="paren">)</span></code></pre>
<pre><code>## [1] 147</code></pre>
<pre class="r"><code class="r"><span class="identifier">ggplot</span><span class="paren">(</span><span class="identifier">temp</span><span class="paren">[</span><span class="identifier">Sales</span> <span class="operator">!=</span> <span class="number">0</span><span class="paren">]</span>, <span class="identifier">aes</span><span class="paren">(</span><span class="identifier">x</span> <span class="operator">=</span> <span class="identifier">Day</span>, <span class="identifier">y</span> <span class="operator">=</span> <span class="identifier">Sales</span><span class="paren">)</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">geom_smooth</span><span class="paren">(</span><span class="paren">)</span> <span class="operator">+</span> 
    <span class="identifier">ggtitle</span><span class="paren">(</span><span class="identifier">paste</span><span class="paren">(</span><span class="string">"Competition opening around day"</span>, <span class="identifier">timespan</span><span class="paren">)</span><span class="paren">)</span></code></pre>
<pre><code>## geom_smooth: method="auto" and size of largest group is &gt;=1000, so using gam with formula: y ~ s(x, bs = "cs"). Use 'method = x' to change the smoothing method.</code></pre>
<p><img src="./output_files/unnamed-chunk-18-1.png" title="" alt="" width="672"></p>
<p>The seasonplot is adapted from <a href="https://www.kaggle.com/spsrini/rossmann-store-sales/seasonplot-month/files">spsrini</a>:</p>
<pre class="r"><code class="r"><span class="identifier">temp</span> <span class="operator">&lt;-</span> <span class="identifier">as.data.frame</span><span class="paren">(</span><span class="identifier">train</span><span class="paren">)</span>
<span class="identifier">temp</span><span class="operator">$</span><span class="identifier">year</span> <span class="operator">&lt;-</span> <span class="identifier">as.factor</span><span class="paren">(</span><span class="identifier">format</span><span class="paren">(</span><span class="identifier">temp</span><span class="operator">$</span><span class="identifier">Date</span>, <span class="string">"%Y"</span><span class="paren">)</span><span class="paren">)</span>
<span class="identifier">temp</span><span class="operator">$</span><span class="identifier">month</span> <span class="operator">&lt;-</span> <span class="identifier">as.factor</span><span class="paren">(</span><span class="identifier">format</span><span class="paren">(</span><span class="identifier">temp</span><span class="operator">$</span><span class="identifier">Date</span>, <span class="string">"%m"</span><span class="paren">)</span><span class="paren">)</span>
<span class="identifier">agg</span> <span class="operator">&lt;-</span> <span class="identifier">aggregate</span><span class="paren">(</span><span class="identifier">Sales</span> <span class="operator">~</span> ., <span class="identifier">data</span><span class="operator">=</span><span class="identifier">temp</span><span class="paren">[</span>, <span class="identifier">c</span><span class="paren">(</span><span class="string">"Sales"</span>, <span class="string">"month"</span> ,<span class="string">"year"</span><span class="paren">)</span><span class="paren">]</span>, <span class="identifier">FUN</span><span class="operator">=</span><span class="identifier">sum</span><span class="paren">)</span>
<span class="identifier">SalesTS</span> <span class="operator">&lt;-</span> <span class="identifier">ts</span><span class="paren">(</span><span class="identifier">agg</span><span class="operator">$</span><span class="identifier">Sales</span>, <span class="identifier">start</span><span class="operator">=</span><span class="number">2013</span>, <span class="identifier">frequency</span><span class="operator">=</span><span class="number">12</span><span class="paren">)</span>
<span class="identifier">col</span> <span class="operator">=</span> <span class="identifier">rainbow</span><span class="paren">(</span><span class="number">3</span><span class="paren">)</span>
<span class="identifier">seasonplot</span><span class="paren">(</span><span class="identifier">SalesTS</span>, <span class="identifier">col</span><span class="operator">=</span><span class="identifier">col</span>, <span class="identifier">year.labels.left</span> <span class="operator">=</span> <span class="literal">TRUE</span>, <span class="identifier">pch</span><span class="operator">=</span><span class="number">19</span>, <span class="identifier">las</span><span class="operator">=</span><span class="number">1</span><span class="paren">)</span></code></pre>
<p><img src="./output_files/unnamed-chunk-19-1.png" title="" alt="" width="672"></p>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>



</body></html>